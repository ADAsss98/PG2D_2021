<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja 1</title>
</head>
<body>
    <canvas id="myCanvas" width="800" height="600"></canvas>
    <script type="text/javascript">
        const canvas = document.getElementById("myCanvas");
		const ctx = canvas.getContext("2d"); 
        
        var rectangleH = 10;
        var rectangleW = 50;
        var xWay = (canvas.width / 2 - rectangleW);
        var yWay = (canvas.height - rectangleH);
        var bulletArray=[];
        var targets = [];

        drawRectangle();
        window.addEventListener("keydown", draw, false);
        setInterval(flyingBullet,10);
        setInterval(createPoints,100);

        function drawRectangle()
        {
            ctx.fillStyle = "red";
            ctx.fillRect(xWay, yWay, rectangleW, rectangleH);
        }
        function draw(e)
        {
            ctx.clearRect(xWay, yWay, rectangleW, rectangleH);
            switch(e.keyCode)
            {
                case 32: //space
                    shoot();
                    break;
                case 37: //left key
                    if (xWay >= 5)
                    {
                        xWay -=5;
                    }
                    else
                    {
                        drawRectangle();
                    }
                    break;
                case 39: //right key
                    if (xWay <= canvas.width - rectangleW - 5)
                    {
                        xWay +=5;
                    }
                    else
                    {
                        drawRectangle();
                    }
                    break;
            }
            drawRectangle();
        }
        function shoot()
        {
            var rad = 10;
            var xBall = xWay + rectangleW/2;
            var yBall = yWay - rectangleH - 10;
            var bullet = new Bullet(xBall,yBall,rad, "rgba(255, 255, 0, 1)");
            bullet.create();
            bulletArray.push(bullet);
        }
        function flyingBullet(bullet)
        {
            for (var i=0; i<bulletArray.length; i++)
            {
                if (bulletArray[i].y == 0)
                {
                    bulletArray[i].delete();
                }
                else
                {
                    if(hitCheck(bulletArray[i]))
                    {
                        bulletArray[i]. delete();
                    }
                    else
                    {
                        bulletArray[i].update();
                        bulletArray[i].create();
                    }
                }
            }
        }

        function Bullet(x,y,rad,color)
        {
            this.xBall =xBall;
            this.yBall =yBall;
            this.rad = rad;
            this.color = color;
        }
        Bullet.prototype={
            create: function()
            {
                ctx.clearRect(this.xBall - 10, this.y, 21 ,21);
                ctx.beginPath();
                ctx.arc(this.xBall, this.y, this.rad, 0, Math.PI *2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
            },
            delete: function(){
                ctx.clearRect(this.xBall - this.rad, this.y - this.rad, this.rad*2+1,this.rad*2+1);
            },
            update: function(){
                this.y -=10;
            },
            deletePoint: function()
            {
                ctx.clearRect(this.xBall-rad, this.y-rad, this.rad*2, this.rad*2);
            }
        }
        function createPoints()
        {
            if(targets.length < 6)
            {
                rad = 20;
                xBall = Math.floor(Math.random() * (Math.floor(max) - Math.ceil(min))) + Math.ceil(min);
                y = 50;
                if (!closeHitCheck(xBall,rad))
                {
                    var bulletPlace = new Bullet(xBall, y, rad, "rgba(255, 255, 0, 1)");
                    bulletPlace.create()
                    targets.push(bulletPlace);
                }
            }
        }

        function hitCheck(bullet)
        {
            for(var i=0; i<targets.length; i++)
                {
                    if((targets[i].xBall + rad + 6) >= bullet.xBall && (targets[i].xBall - rad + 6) <= bullet.xBall && (targets[i].y + rad + 6) >= bullet.y && (targets[i].y - rad + 6) <= bullet.y)
                    {
                        targets[i].deletePoint();
                        return true;
                        break;
                    }
                }
        }
        function closeHitCheck()
        {
            for(var i=0; i<targets.length; i++)
            {
                if((targets[i].x + rad + 20) >= xBall && (targets[i].xBall - rad - 20) <= xBall)
                    {
                        return false;
                        break;
                    }
            }
        }
</script>
</body>
</html>