<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja 1</title>
</head>
<body>
    <canvas id="myCanvas" width="800" height="600"></canvas>
    <script type="text/javascript">
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");
            
            var rectangleH = 10;
            var rectangleW = 50;
            var xWay = canvas.width/2-rectangleH;
            var yWay = canvas.height-rectangleH;
            var bulletArray = [];
            var targets = [];
            var targetColor = "rgba(100, 200, 100, 1)";

            drawRectangle();
            window.addEventListener("keydown", draw, false);
            setInterval(flyingBullet,25)
            setInterval(createPoints,200)

        function drawRectangle()
        {
            ctx.fillStyle = "red";
            ctx.fillRect(xWay, yWay, rectangleW, rectangleH);
        }
        function draw(e)
        {
            ctx.clearRect(xWay, yWay, rectangleW, rectangleH);
            switch(e.keyCode)
            {
                case 32: //space
                    shoot();
                    break;
                case 37: //left key
                    if (xWay >= 5)
                    {
                        xWay -=5;
                    }
                    else
                    {
                        drawRectangle();
                    }
                    break;
                case 39: //right key
                    if (xWay <= canvas.width - rectangleW - 5)
                    {
                        xWay +=5;
                    }
                    else
                    {
                        drawRectangle();
                    }
                    break;
            }
            drawRectangle();
        }
        function shoot()
        {
            var rad = 5;
            var xBall = xWay + rectangleW/2;
            var yBall = yWay - rectangleH - 10;
            var bullet = new Bullet(xBall,yBall,rad, "rgba(255, 255, 0, 1)");
            bullet.create();
            bulletArray.push(bullet);
        }
        function flyingBullet(bullet)
        {
            for (var i=0; i<bulletArray.length; i++)
            {
                if (bulletArray[i].y == 0)
                {
                    bulletArray[i].delete()
                    bulletArray.splice(i,1)
                }
                else
                {
                    if(hitCheck(bulletArray[i]))
                    {
                        bulletArray[i]. delete()
                        bulletArray.splice(i,1)
                    }
                    else
                    {
                        bulletArray[i].update();
                        bulletArray[i].create();
                    }
                }
            }
        }

        function Bullet(x, y, rad, color)
        {
            this.x =x;
            this.y =y;
            this.rad = rad;
            this.color = color;
        }
        Bullet.prototype={
            create: function()
            {
                ctx.clearRect(this.x - 10, this.y, 20 ,20);
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.rad, 0, Math.PI *2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
            },
            delete: function(){
                ctx.clearRect(this.x - this.rad, this.y - this.rad, this.rad*2+1,this.rad*2+1);
            },
            update: function(){
                this.y -=10;
            },
            deletePoint: function()
            {
                ctx.clearRect(this.x-rad, this.y-rad, this.rad*2, this.rad*2);
            }
        };
        function createPoints()
        {
            if(targets.length < 10)
            {
                rad = 25;
                x = Math.floor(Math.random() * (Math.floor(canvas.width-rad*2) - Math.ceil(rad * 2))) + Math.ceil(rad * 2);
                y = 50;
                if (!closeHitCheck(x,rad))
                {
                    var bulletPlace = new Bullet(x, y, rad, targetColor);
                    bulletPlace.create()
                    targets.push(bulletPlace);
                }
            }
        }

        function hitCheck(bullet)
        {
            for(var i=0; i<targets.length; i++)
                {
                    if((targets[i].x + rad + 6) >= bullet.x && (targets[i].x - rad + 6) <= bullet.x && (targets[i].y + rad + 6) >= bullet.y && (targets[i].y - rad + 6) <= bullet.y)
                    {
                        targets[i].deletePoint()
                        targets.splice(i,1)
                        return true;
                        break;
                    }
                }
        }
        function closeHitCheck(x, rad)
        {
            for(var i=0; i<targets.length; i++)
            {
                if((targets[i].x + rad + 20) >= x && (targets[i].x - rad - 20) <= x)
                    {
                        return true;
                        break;
                    }
            }
        }
</script>
</body>
</html>