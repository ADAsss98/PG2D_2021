<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja 2</title>
</head>
<body>
    <canvas id="myCanvas" width="800" height="600"></canvas>
	<script type="text/javascript">
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

		var carW = (canvas.width/2)-100;
        var carH = (canvas.height)-130;
		var xWay1 = carW;
        var yWay1 = carH+15;
        var xWay2 = carW;
        var yWay2 = carH+65;
    	var carX = 50;
        var carY = 80;
        var speed = 9;
		var rightPressed = false;
        var leftPressed = false;
		var count = 0;
        var checker = 0;
		var lines = [];
		let reqAnim;

		class Line
        {
			constructor(x, y, width, height, color, speed)
            {
				this.x = x;
				this.y = y;
				this.width = width;
				this.height = height;
                this.color = color;
				this.speed = speed;
			}

			drawRectangle()
            {
                drawRect(this.x, this.y, this.width, this.height, this.color);
            }
			update()
            {
                this.y = this.y + this.speed;
            }
		}

		function rand(min, max)
        {
			min = Math.ceil(min); max = Math.floor(max);
			return Math.floor(Math.random() * (max - min)) + min;
		}

		document.addEventListener('keydown', function(e)
        {
			e.preventDefault();
			if (e.keyCode === 39) rightPressed = true;
			if (e.keyCode === 37) leftPressed = true;
		});

		document.addEventListener('keyup', function(e)
        {
			e.preventDefault();
			if (e.keyCode === 39) rightPressed = false;
			if (e.keyCode === 37) leftPressed = false;
		});

		function drawRect(x,y,width,height,color)
        {
			ctx.beginPath();
			ctx.rect(x,y,width,height);
			ctx.fillStyle = color;
			ctx.fill();
			ctx.closePath();
		};
		
		function drawRoad()
        {
			drawRect(100, -400, 450, 1400, "gray");
			drawRect(-200, -400, 250, 1400, "green");
			drawRect(600, -400, 250, 1400, "green");
		};
		function drawCar(x,y,width,height,color)
        {
			drawRect(x,y,width,height,color);
		};
		
		function stopAnimation()
        {
            window.cancelAnimationFrame(reqAnim);
        };

		function animate()
        {
			ctx.clearRect(0,0, 800,600);
			reqAnim= window.requestAnimationFrame(animate);
			count += 1;
			if (rightPressed && carW<500) {
        		 carW += speed;
    		} else if (leftPressed && carW>100) {
        		carW -= speed;
    		};
			ctx.save();
			if(checker==1){
				ctx.translate(-150+canvas.width/2,canvas.height/2);
				ctx.rotate(5 * Math.PI / 180);
				ctx.translate(150-canvas.width/2,-canvas.height/2);
			};
			if(checker==2){
				ctx.translate(-150+canvas.width/2,canvas.height/2);
				ctx.rotate(-(5 * Math.PI / 180));
				ctx.translate(150-canvas.width/2,-canvas.height/2);
			};

			drawRoad();
			if(count%20==0){
				lines.push(new Line(50,-100,50,70,"red",7));
				lines.push(new Line(550,-100,50,70,"red",7));
				lines.push(new Line(320,-100,10,70,"white",7));
				};
			lines.forEach(function (line, i) {
				line.drawRectangle();
				line.update();
				if(line.y > canvas.height + 100) lines.splice(i, 1);
			});

			drawCar(carW, carH, carX, carY, "blue");
			ctx.stroke();
			ctx.restore();

			if(count%300==0)
            {
			    speed+=1;
			}
			if(count%400==0)
                checker=1;
			if(count%800==0)
                checker=0;
			if(count%900==0)
                checker=2;
		};

        animate();

</script>
</body>
</html>